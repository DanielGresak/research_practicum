stages:
    - test
    - deploy

test:
    stage: test
    image: python:3.9-alpine
    before_script:
        - docker-compose up --build -d
    script:
        - docker exec researchpracticum_app_1 sh -c "python manage.py test"

# Type-test:
#     stage: test
#     image: python:3.9-alpine
#     script:
#         - bash -c "pip3 install mypy"
#         - bash -c "mypy core"
#     allow_failure: true
    
Lint-test:
    stage: test
    image: python:3.9-alpine
    script:
        - bash -c "pip install flake8"
        - bash -c "flake8"
    allow_failure: true

deploy:
    image: python:3.9-alpine
    stage: deploy
    only:
        - master
        - developement
    script:
        - docker-compose -f docker-compose-deploy.yml up --build -d
